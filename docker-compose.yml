# ==============================================================================
# Docker Compose for Local Development
# ==============================================================================
# Usage:
#   1. Copy .env.example to .env and fill in your values
#   2. Run: docker-compose up --build
#   3. Access at http://localhost:3000
# ==============================================================================

version: '3.8'

services:
  moltbot:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        MOLTBOT_VERSION: main
    
    container_name: moltbot-local
    
    ports:
      - "${PORT:-3000}:3000"
    
    environment:
      # System
      - NODE_ENV=production
      - PORT=3000
      - CLAWDBOT_STATE_DIR=/data
      - CLAWDBOT_PREFER_PNPM=1
      - NODE_OPTIONS=--max-old-space-size=1536
      
      # AI Provider (from .env)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      
      # Channels (from .env)
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN:-}
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN:-}
    
    volumes:
      # Persist data across restarts
      - moltbot-data:/data
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "/app/scripts/healthcheck.sh"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  moltbot-data:
    driver: local
